name: Tenant-Management API Workflow

on: [push, pull_request]

env:
  SERVICE_NAME: tenant-management-api

  strategy:
    matrix:
      mongodb-version: [ '6.0.5']

jobs:
  code-review-and-test:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Github Repo
        uses: actions/checkout@v3

      - name: Setup Go
        uses: actions/setup-go@v4.0.0

      - name: Run Linter
        uses: reviewdog/action-golangci-lint@v2
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          level: info
          golangci_lint_flags: "-E wastedassign -E unconvert -E stylecheck -E revive -E nilerr -E nestif -E ireturn -E gosec"

      - name: Start MongoDB
        uses: supercharge/mongodb-github-action@1.8.0
        with:
          mongodb-version: ${{ matrix.mongodb-version }}
          mongodb-port: 27017

      - name: Run Unit and Integration Tests
        run: go test -v ./...
